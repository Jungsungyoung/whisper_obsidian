<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="/static/manifest.json">
  <link rel="apple-touch-icon" href="/static/icon-192.png">
  <meta name="theme-color" content="#2563eb">
  <title>MeetScribe</title>
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f4f4f2;
      --surface: #ffffff;
      --surface-2: #fafaf9;
      --border: #e2e2e0;
      --border-strong: #c4c4c2;
      --text: #1a1a1a;
      --text-2: #575757;
      --text-3: #9c9c9c;
      --accent: #2563eb;
      --accent-bg: #eff6ff;
      --accent-border: #bfdbfe;
      --success: #15803d;
      --success-bg: #f0fdf4;
      --success-border: #bbf7d0;
      --danger: #dc2626;
      --danger-bg: #fef2f2;
      --danger-border: #fecaca;
      --warn-bg: #fffbeb;
      --warn-border: #fde68a;
      --warn-text: #92400e;
      --warn-dot: #d97706;
      --radius: 8px;
      --radius-lg: 12px;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --font: 'Pretendard Variable', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--font);
      font-size: 14px;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    /* â”€â”€ HEADER â”€â”€ */
    .app-header {
      position: sticky; top: 0; z-index: 50;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      height: 52px;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 24px;
    }
    .header-left { display: flex; align-items: center; gap: 10px; }
    .logo-mark {
      width: 28px; height: 28px;
      background: var(--accent); border-radius: 6px;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .logo-mark svg { color: #fff; }
    .logo-text { font-weight: 700; font-size: 1rem; letter-spacing: -0.02em; }
    .logo-sep { width: 1px; height: 16px; background: var(--border); margin: 0 4px; }
    .logo-sub { font-size: 0.75rem; color: var(--text-3); }
    @media (max-width: 580px) { .logo-sep, .logo-sub { display: none; } }

    #settings-btn {
      display: flex; align-items: center; gap: 6px;
      padding: 6px 12px;
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
      color: var(--text-2); font-family: var(--font); font-size: 0.8rem;
      cursor: pointer; transition: all .15s;
    }
    #settings-btn:hover { border-color: var(--border-strong); color: var(--text); background: var(--surface-2); }

    /* â”€â”€ LAYOUT â”€â”€ */
    .main {
      max-width: 960px; margin: 0 auto;
      padding: 24px 20px;
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 16px; align-items: start;
    }
    @media (max-width: 720px) { .main { grid-template-columns: 1fr; } }

    /* â”€â”€ MOBILE â”€â”€ */
    @media (max-width: 640px) {
      /* iOS ìë™ ì¤Œì¸ ë°©ì§€: í…ìŠ¤íŠ¸ ì…ë ¥ font-size 16px ì´ìƒ */
      input[type=text], input[type=password], select, textarea {
        font-size: 16px;
      }
      /* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ â€” ë” í¬ê²Œ */
      #drop-zone { padding: 28px 16px; }
      .dz-icon { width: 44px; height: 44px; }
      .dz-text { font-size: 1rem; }
      /* ë…¹ìŒ ë²„íŠ¼ í„°ì¹˜ ì˜ì—­ í™•ëŒ€ */
      #rec-start-btn { padding: 14px; font-size: 0.95rem; }
      #rec-stop-btn  { padding: 10px 18px; font-size: 0.85rem; }
      #rec-confirm-ok, #rec-confirm-cancel { padding: 10px 16px; font-size: 0.85rem; }
      /* ë©”ì¸ ì œì¶œ ë²„íŠ¼ */
      #btn { padding: 15px; font-size: 1rem; }
    }

    /* â”€â”€ CARD â”€â”€ */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }
    .card-body { padding: 20px; }
    .card-body + .card-body { border-top: 1px solid var(--border); }

    /* â”€â”€ DROP ZONE â”€â”€ */
    #drop-zone {
      border: 1.5px dashed var(--border-strong); border-radius: var(--radius);
      padding: 28px 20px; text-align: center; cursor: pointer;
      background: var(--surface-2); margin-bottom: 14px;
      transition: all .2s;
    }
    #drop-zone:hover, #drop-zone.over {
      border-color: var(--accent); background: var(--accent-bg);
    }
    #drop-zone:hover .dz-icon, #drop-zone.over .dz-icon { color: var(--accent); }
    .dz-icon { margin: 0 auto 10px; color: var(--text-3); width: 36px; height: 36px; transition: color .2s; }
    .dz-text { font-size: 0.875rem; color: var(--text-2); font-weight: 500; }
    .dz-hint { font-size: 0.73rem; color: var(--text-3); margin-top: 4px; }
    #fname { font-size: 0.78rem; color: var(--accent); margin-top: 8px; font-weight: 500; min-height: 1em; word-break: break-all; }
    input[type=file] { display: none; }

    /* â”€â”€ OR DIVIDER â”€â”€ */
    .or-divider {
      display: flex; align-items: center; gap: 10px;
      margin: 12px 0; font-size: 0.72rem; color: var(--text-3);
    }
    .or-divider::before, .or-divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }

    /* â”€â”€ RECORDING â”€â”€ */
    #rec-start-btn {
      width: 100%; padding: 9px;
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
      color: var(--text-2); font-family: var(--font); font-size: 0.8rem;
      cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 7px;
      transition: all .15s;
    }
    #rec-start-btn:hover:not(:disabled) { border-color: var(--danger-border); color: var(--danger); background: var(--danger-bg); }
    #rec-start-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .rec-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--danger); flex-shrink: 0; }

    #rec-active {
      display: none; align-items: center; gap: 10px;
      padding: 10px 14px; margin-top: 10px;
      background: var(--danger-bg); border: 1px solid var(--danger-border); border-radius: var(--radius);
    }
    @keyframes pulse-dot { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(1.3)} }
    .pulse-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--danger); flex-shrink: 0; animation: pulse-dot 1s ease-in-out infinite; }
    #rec-timer { font-family: var(--font-mono); font-size: 0.82rem; color: var(--danger); flex: 1; }
    #rec-stop-btn {
      padding: 5px 12px; background: var(--surface);
      border: 1px solid var(--danger-border); border-radius: 6px;
      color: var(--danger); font-family: var(--font); font-size: 0.75rem; cursor: pointer; transition: background .15s;
    }
    #rec-stop-btn:hover { background: #fff1f2; }

    #rec-confirm {
      display: none; align-items: center; gap: 8px;
      padding: 10px 14px; margin-top: 10px; font-size: 0.8rem;
      background: var(--success-bg); border: 1px solid var(--success-border); border-radius: var(--radius);
    }
    #rec-confirm-label { color: var(--success); flex: 1; font-weight: 500; }
    #rec-confirm-ok {
      padding: 5px 12px; background: var(--success-bg);
      border: 1px solid var(--success-border); border-radius: 6px;
      color: var(--success); font-family: var(--font); font-size: 0.75rem; font-weight: 500; cursor: pointer; transition: background .15s;
    }
    #rec-confirm-ok:hover { background: #dcfce7; }
    #rec-confirm-cancel {
      padding: 5px 10px; background: none;
      border: 1px solid var(--border); border-radius: 6px;
      color: var(--text-3); font-family: var(--font); font-size: 0.75rem; cursor: pointer; transition: all .15s;
    }
    #rec-confirm-cancel:hover { color: var(--text-2); border-color: var(--border-strong); }

    /* â”€â”€ FIELDS â”€â”€ */
    .field { margin-bottom: 12px; }
    .fields-start { margin-top: 16px; }
    label { display: block; font-size: 0.78rem; font-weight: 500; color: var(--text-2); margin-bottom: 5px; }
    label .opt { font-weight: 400; color: var(--text-3); }
    input[type=text], input[type=password], select, textarea {
      width: 100%; padding: 8px 11px;
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
      color: var(--text); font-size: 0.875rem; font-family: var(--font);
      outline: none; transition: border-color .15s, box-shadow .15s;
    }
    input:focus, select:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37,99,235,.1);
    }
    ::placeholder { color: var(--text-3); }
    select option { background: var(--surface); }
    textarea { resize: vertical; line-height: 1.55; min-height: 52px; }

    /* â”€â”€ BUTTONS â”€â”€ */
    #btn {
      width: 100%; padding: 11px;
      background: var(--accent); color: #fff; border: none; border-radius: var(--radius);
      font-family: var(--font); font-size: 0.875rem; font-weight: 600;
      cursor: pointer; transition: all .15s; margin-top: 4px; letter-spacing: -0.01em;
    }
    #btn:hover:not(:disabled) { background: #1d4ed8; box-shadow: 0 4px 12px rgba(37,99,235,.3); transform: translateY(-1px); }
    #btn:active { transform: translateY(0); }
    #btn:disabled { background: var(--border); color: var(--text-3); cursor: not-allowed; box-shadow: none; transform: none; }

    #cancel-btn {
      width: 100%; padding: 9px; margin-top: 8px;
      background: none; border: 1px solid var(--border); border-radius: var(--radius);
      color: var(--text-2); font-family: var(--font); font-size: 0.8rem;
      cursor: pointer; transition: all .15s; display: none;
    }
    #cancel-btn:hover { border-color: var(--danger-border); color: var(--danger); background: var(--danger-bg); }

    /* â”€â”€ ERROR â”€â”€ */
    #err {
      margin-top: 12px; padding: 10px 12px;
      background: var(--danger-bg); border: 1px solid var(--danger-border); border-radius: var(--radius);
      font-size: 0.8rem; color: var(--danger); display: none; line-height: 1.5;
    }

    /* â”€â”€ PROGRESS â”€â”€ */
    #progress { display: none; }
    .steps { display: flex; flex-direction: column; }
    .step {
      display: flex; align-items: center; gap: 12px;
      padding: 8px 0; font-size: 0.83rem; color: var(--text-3);
      position: relative;
    }
    .step + .step::before {
      content: ''; position: absolute; left: 9px; top: 0;
      width: 1px; height: 9px; background: var(--border);
    }
    .step.done + .step::before, .step.active + .step::before { background: var(--accent); }

    .step .ico {
      width: 20px; height: 20px; border-radius: 50%;
      border: 1.5px solid var(--border-strong);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.6rem; flex-shrink: 0;
      background: var(--surface); color: transparent;
      transition: all .25s;
    }
    .step.active .ico { border-color: var(--accent); background: var(--accent); color: #fff; }
    .step.done .ico { border-color: var(--success); background: var(--success); color: #fff; }
    .step.active { color: var(--text); font-weight: 500; }
    .step.done { color: var(--text-2); }
    .step-label { flex: 1; }

    #progress-bar-wrap { margin-top: 14px; background: var(--border); border-radius: 99px; height: 3px; overflow: hidden; }
    #progress-bar { height: 100%; width: 0%; background: var(--accent); border-radius: 99px; transition: width .5s ease; }

    #progress-detail {
      margin-top: 8px; font-size: 0.72rem; color: var(--text-3);
      min-height: 1.2em; display: flex; justify-content: space-between;
    }
    #progress-detail .detail-text { color: var(--accent); }

    /* â”€â”€ LOG PANEL â”€â”€ */
    #log-panel {
      margin-top: 12px;
      background: var(--surface-2); border: 1px solid var(--border); border-radius: var(--radius);
      padding: 10px 12px; height: 150px; overflow-y: auto;
      font-family: var(--font-mono); font-size: 0.7rem; display: none;
    }
    #log-panel::-webkit-scrollbar { width: 4px; }
    #log-panel::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
    .log-line { color: var(--text-3); line-height: 1.8; white-space: pre-wrap; }
    .log-line.latest { color: var(--text-2); }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
    .cursor { display: inline-block; width: 5px; height: 11px; background: var(--accent); margin-left: 3px; vertical-align: middle; animation: blink 1s step-start infinite; }

    /* â”€â”€ RIGHT PLACEHOLDER â”€â”€ */
    #right-placeholder {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      min-height: 240px; gap: 10px;
      color: var(--text-3); font-size: 0.8rem;
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
    }
    .ph-icon { color: var(--border-strong); }

    /* â”€â”€ REVIEW PANEL â”€â”€ */
    #review-panel {
      display: none; background: var(--surface);
      border: 1px solid var(--border); border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm); overflow: hidden;
    }
    .review-header {
      padding: 12px 20px; background: var(--warn-bg); border-bottom: 1px solid var(--warn-border);
      display: flex; align-items: center; gap: 8px;
    }
    .review-badge { width: 6px; height: 6px; border-radius: 50%; background: var(--warn-dot); flex-shrink: 0; animation: blink 2s ease-in-out infinite; }
    .review-title { font-size: 0.8rem; font-weight: 600; color: var(--warn-text); }
    .review-body { padding: 16px 20px; }
    .rv-field { margin-bottom: 12px; }
    .rv-field label { color: var(--text-2); }
    .rv-field textarea { font-size: 0.8rem; min-height: 48px; background: var(--surface-2); }

    #rv-speakers { margin-bottom: 4px; }
    .rv-speaker-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
    .rv-speaker-label { font-family: var(--font-mono); font-size: 0.72rem; color: var(--text-3); width: 72px; flex-shrink: 0; }
    .rv-speaker-arrow { color: var(--border-strong); font-size: 0.75rem; }
    .rv-speaker-input {
      flex: 1; padding: 5px 9px;
      background: var(--surface); border: 1px solid var(--border); border-radius: 6px;
      color: var(--text); font-size: 0.8rem; font-family: var(--font); outline: none; transition: border-color .15s, box-shadow .15s;
    }
    .rv-speaker-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(37,99,235,.1); }

    .rv-actions { display: flex; gap: 8px; margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--border); }
    #rv-save-btn {
      flex: 1; padding: 9px;
      background: var(--accent); border: none; border-radius: var(--radius);
      color: #fff; font-family: var(--font); font-size: 0.875rem; font-weight: 600;
      cursor: pointer; transition: all .15s;
    }
    #rv-save-btn:hover:not(:disabled) { background: #1d4ed8; }
    #rv-save-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    #rv-cancel-btn {
      padding: 9px 16px; background: none;
      border: 1px solid var(--border); border-radius: var(--radius);
      color: var(--text-2); font-family: var(--font); font-size: 0.8rem;
      cursor: pointer; transition: all .15s;
    }
    #rv-cancel-btn:hover { border-color: var(--danger-border); color: var(--danger); background: var(--danger-bg); }

    /* â”€â”€ RESULT â”€â”€ */
    #result { display: none; }
    .result-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); overflow: hidden;
    }
    .result-header {
      padding: 12px 20px; background: var(--success-bg); border-bottom: 1px solid var(--success-border);
      display: flex; align-items: center; gap: 8px;
      font-size: 0.8rem; font-weight: 600; color: var(--success);
    }
    .result-body { padding: 16px 20px; }
    .result-hint { font-size: 0.78rem; color: var(--text-3); margin-bottom: 12px; }
    .obs-btn {
      display: flex; align-items: center; gap: 10px;
      width: 100%; padding: 11px 14px;
      background: var(--surface-2); border: 1px solid var(--border); border-radius: var(--radius);
      color: var(--text); font-size: 0.83rem; font-weight: 500;
      text-decoration: none; font-family: var(--font);
      margin-bottom: 8px; cursor: pointer; transition: all .15s;
    }
    .obs-btn:last-child { margin-bottom: 0; }
    .obs-btn:hover { border-color: var(--accent-border); background: var(--accent-bg); color: var(--accent); }
    .obs-btn-icon {
      width: 28px; height: 28px; border-radius: 6px; background: var(--border);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.82rem; flex-shrink: 0; transition: background .15s;
    }
    .obs-btn:hover .obs-btn-icon { background: var(--accent-border); }

    /* â”€â”€ SETTINGS MODAL â”€â”€ */
    #modal-overlay {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,0.35); z-index: 200;
      align-items: center; justify-content: center; backdrop-filter: blur(2px);
    }
    #modal-overlay.open { display: flex; }
    .modal {
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg);
      width: 460px; max-height: 90vh; overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.12), 0 8px 20px rgba(0,0,0,0.06);
    }
    .modal::-webkit-scrollbar { width: 4px; }
    .modal::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
    .modal-header {
      position: sticky; top: 0; background: var(--surface);
      padding: 16px 20px; border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center; z-index: 1;
    }
    .modal-title { font-weight: 600; font-size: 0.9rem; }
    #modal-close {
      width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;
      background: none; border: 1px solid var(--border); border-radius: 6px;
      cursor: pointer; color: var(--text-3); font-size: 0.75rem; transition: all .15s;
    }
    #modal-close:hover { border-color: var(--border-strong); color: var(--text-2); background: var(--surface-2); }
    .modal-body { padding: 20px; }
    .modal-section { margin-bottom: 22px; }
    .modal-section:last-child { margin-bottom: 0; }
    .modal-section-title {
      font-size: 0.7rem; font-weight: 600; color: var(--text-3);
      text-transform: uppercase; letter-spacing: 0.06em;
      margin-bottom: 10px; padding-bottom: 6px; border-bottom: 1px solid var(--border);
    }
    .modal-field { margin-bottom: 10px; }
    .modal-field textarea { min-height: 72px; }
    .modal-footer { padding: 16px 20px; border-top: 1px solid var(--border); background: var(--surface-2); }
    #save-btn {
      width: 100%; padding: 10px;
      background: var(--accent); color: #fff; border: none; border-radius: var(--radius);
      font-family: var(--font); font-size: 0.875rem; font-weight: 600;
      cursor: pointer; transition: all .15s;
    }
    #save-btn:hover { background: #1d4ed8; }
    #save-msg { font-size: 0.75rem; color: var(--success); text-align: center; margin-top: 8px; min-height: 1em; }

    /* â”€â”€ CATEGORY TABS â”€â”€ */
    .category-tabs {
      display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 14px;
    }
    .cat-tab {
      padding: 5px 12px; border-radius: 20px; border: 1px solid var(--border);
      background: var(--surface-2); color: var(--text-2);
      font-family: var(--font); font-size: 0.78rem; cursor: pointer;
      transition: all .15s;
    }
    .cat-tab:hover { border-color: var(--border-strong); color: var(--text); }
    .cat-tab.active {
      background: var(--accent); border-color: var(--accent); color: #fff;
    }
    /* â”€â”€ CATEGORY FORM GROUPS â”€â”€ */
    .cat-fields { display: none; }
    .cat-fields.visible { display: block; }
  </style>
</head>
<body>

<!-- ì„¤ì • ëª¨ë‹¬ -->
<div id="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title">ì„¤ì •</span>
      <button id="modal-close">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="modal-section">
        <div class="modal-section-title">ì „ì‚¬ ëª¨ë¸</div>
        <div class="modal-field">
          <label for="s-whisper">Whisper ëª¨ë¸</label>
          <select id="s-whisper">
            <option value="tiny">tiny â€” ê°€ì¥ ë¹ ë¦„, ë‚®ì€ ì •í™•ë„</option>
            <option value="base">base â€” ë¹ ë¦„, ë³´í†µ ì •í™•ë„</option>
            <option value="small">small â€” ë³´í†µ, ì¢‹ì€ ì •í™•ë„</option>
            <option value="medium">medium â€” ëŠë¦¼, ë†’ì€ ì •í™•ë„</option>
            <option value="large">large â€” ê°€ì¥ ëŠë¦¼, ìµœê³  ì •í™•ë„</option>
          </select>
        </div>
      </div>
      <div class="modal-section">
        <div class="modal-section-title">API í‚¤</div>
        <div class="modal-field">
          <label for="s-gemini">Gemini API í‚¤</label>
          <input type="password" id="s-gemini" placeholder="AIza... (ë¹„ì›Œë‘ë©´ ë³€ê²½ ì•ˆ í•¨)">
        </div>
        <div class="modal-field">
          <label for="s-openai">OpenAI API í‚¤</label>
          <input type="password" id="s-openai" placeholder="sk-... (ë¹„ì›Œë‘ë©´ ë³€ê²½ ì•ˆ í•¨)">
        </div>
        <div class="modal-field">
          <label for="s-hf">HuggingFace í† í° <span class="opt">(í™”ì ë¶„ë¦¬ìš©)</span></label>
          <input type="password" id="s-hf" placeholder="hf_... (ë¹„ì›Œë‘ë©´ ë³€ê²½ ì•ˆ í•¨)">
        </div>
      </div>
      <div class="modal-section">
        <div class="modal-section-title">Obsidian Vault</div>
        <div class="modal-field">
          <label for="s-vault">Vault ê²½ë¡œ</label>
          <input type="text" id="s-vault" placeholder="C:\Users\...\Obsidian Vault">
        </div>
        <div class="modal-field">
          <label for="s-folder">íšŒì˜ ë…¸íŠ¸ ì €ì¥ í´ë”</label>
          <input type="text" id="s-folder" placeholder="10_Calendar/13_Meetings">
        </div>
      </div>
      <div class="modal-section">
        <div class="modal-section-title">ì¹´í…Œê³ ë¦¬ë³„ ì €ì¥ í´ë”</div>
        <div class="modal-field">
          <label for="s-inbox-folder">ë³´ì´ìŠ¤ ë©”ëª¨ í´ë”</label>
          <input type="text" id="s-inbox-folder" placeholder="00_Inbox">
        </div>
        <div class="modal-field">
          <label for="s-daily-folder">ë°ì¼ë¦¬ í´ë”</label>
          <input type="text" id="s-daily-folder" placeholder="10_Calendar/11_Daily">
        </div>
        <div class="modal-field">
          <label for="s-areas-folder">ê°•ì˜ í´ë”</label>
          <input type="text" id="s-areas-folder" placeholder="30_Areas">
        </div>
        <div class="modal-field">
          <label for="s-projects-folder">í”„ë¡œì íŠ¸ ë…¼ì˜ ê¸°ë³¸ í´ë”</label>
          <input type="text" id="s-projects-folder" placeholder="20_Projects">
        </div>
        <div class="modal-field">
          <label for="s-resources-folder">ë ˆí¼ëŸ°ìŠ¤ í´ë”</label>
          <input type="text" id="s-resources-folder" placeholder="40_Resources">
        </div>
      </div>
      <div class="modal-section">
        <div class="modal-section-title">ì „ì‚¬ ì •í™•ë„</div>
        <div class="modal-field">
          <label for="s-domain-vocab">ë„ë©”ì¸ ìš©ì–´ íŒíŠ¸</label>
          <textarea id="s-domain-vocab" rows="3" placeholder="í•¨ì •, ì„ ë°•, ì „íˆ¬ì²´ê³„, ì†Œë‚˜, ë ˆì´ë”, ..."></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button id="save-btn">ì €ì¥</button>
      <div id="save-msg"></div>
    </div>
  </div>
</div>

<!-- í—¤ë” -->
<header class="app-header">
  <div class="header-left">
    <div class="logo-mark">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
        <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
        <line x1="12" y1="19" x2="12" y2="23"/>
        <line x1="8" y1="23" x2="16" y2="23"/>
      </svg>
    </div>
    <span class="logo-text">MeetScribe</span>
    <div class="logo-sep"></div>
    <span class="logo-sub">íšŒì˜ ë…¹ìŒ â†’ ì „ì‚¬ â†’ Obsidian ë…¸íŠ¸</span>
  </div>
  <button id="settings-btn" title="ì„¤ì •">
    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="3"/>
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
    </svg>
    ì„¤ì •
  </button>
</header>

<!-- ë©”ì¸ -->
<main class="main">
  <!-- ì™¼ìª½: ì…ë ¥ + ì§„í–‰ -->
  <div class="col-left">
    <div class="card">
      <div class="card-body">
        <!-- ë“œë¡­ì¡´ -->
        <div id="drop-zone" role="button" tabindex="0" aria-label="íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­"
             onclick="document.getElementById('fi').click()"
             onkeydown="if(event.key==='Enter')document.getElementById('fi').click()">
          <div class="dz-icon">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="16 16 12 12 8 16"/>
              <line x1="12" y1="12" x2="12" y2="21"/>
              <path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/>
            </svg>
          </div>
          <div class="dz-text">íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</div>
          <div class="dz-hint">MP3 Â· WAV Â· M4A Â· MP4 Â· WEBM Â· OGG</div>
          <div id="fname"></div>
        </div>

        <div class="or-divider">ë˜ëŠ”</div>

        <!-- ë…¹ìŒ -->
        <div id="rec-idle">
          <button id="rec-start-btn" type="button">
            <span class="rec-dot"></span>ë§ˆì´í¬ë¡œ ë…¹ìŒ ì‹œì‘
          </button>
        </div>
        <div id="rec-active">
          <span class="pulse-dot"></span>
          <span id="rec-timer">00:00</span>
          <button id="rec-stop-btn" type="button">â–  ì¤‘ë‹¨</button>
        </div>
        <div id="rec-confirm">
          <span id="rec-confirm-label"></span>
          <button id="rec-confirm-ok" type="button">â–¶ ì „ì‚¬ ì‹œì‘</button>
          <button id="rec-confirm-cancel" type="button">âœ• ì¬ë…¹ìŒ</button>
        </div>

        <input type="file" id="fi" accept="*/*">

        <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
        <div class="category-tabs" style="margin-top:16px">
          <button class="cat-tab active" data-cat="meeting">íšŒì˜</button>
          <button class="cat-tab" data-cat="voice_memo">ë³´ì´ìŠ¤ ë©”ëª¨</button>
          <button class="cat-tab" data-cat="daily">ë°ì¼ë¦¬</button>
          <button class="cat-tab" data-cat="lecture">ê°•ì˜/ì„¸ë¯¸ë‚˜</button>
          <button class="cat-tab" data-cat="discussion">í”„ë¡œì íŠ¸ ë…¼ì˜</button>
          <button class="cat-tab" data-cat="reference">ë ˆí¼ëŸ°ìŠ¤</button>
        </div>

        <!-- íšŒì˜ / í”„ë¡œì íŠ¸ ë…¼ì˜ ê³µí†µ í•„ë“œ -->
        <div class="cat-fields visible" id="fields-meeting-like">
          <div class="field">
            <label for="title" id="title-label">íšŒì˜ ì œëª©</label>
            <input type="text" id="title" placeholder="ë¹„ì›Œë‘ë©´ íŒŒì¼ëª… ì‚¬ìš©">
          </div>
          <div class="field" id="project-field">
            <label for="project">í”„ë¡œì íŠ¸</label>
            <select id="project"><option value="">ì„ íƒ ì•ˆ í•¨</option></select>
          </div>
          <div class="field">
            <label for="context" id="context-label">íšŒì˜ ë§¥ë½ <span class="opt">(ì „ì‚¬Â·ë¶„ì„ ì •í™•ë„ í–¥ìƒ)</span></label>
            <textarea id="context" rows="2" placeholder="ì˜ˆ: ë ˆì´ë” ì‹œìŠ¤í…œ ì„¤ê³„ ê²€í† , ì „íˆ¬ì²´ê³„ í†µí•© ì¼ì • ë…¼ì˜"></textarea>
          </div>
        </div>

        <!-- ë³´ì´ìŠ¤ ë©”ëª¨ í•„ë“œ -->
        <div class="cat-fields" id="fields-voice-memo">
          <div class="field">
            <label for="vm-title">ë©”ëª¨ ì œëª©</label>
            <input type="text" id="vm-title" placeholder="ë¹„ì›Œë‘ë©´ íŒŒì¼ëª… ì‚¬ìš©">
          </div>
          <div class="field">
            <label for="vm-context">ë©”ëª¨ ë§¥ë½ <span class="opt">(ì„ íƒ)</span></label>
            <textarea id="vm-context" rows="2" placeholder="ì˜ˆ: í‡´ê·¼ê¸¸ ì•„ì´ë””ì–´ ë©”ëª¨"></textarea>
          </div>
        </div>

        <!-- ë°ì¼ë¦¬ ì—…ë¬´ì¼ì§€ í•„ë“œ -->
        <div class="cat-fields" id="fields-daily">
          <div class="field">
            <label for="daily-context">ì¶”ê°€ ë©”ëª¨ <span class="opt">(ì„ íƒ)</span></label>
            <textarea id="daily-context" rows="2" placeholder="ì˜ˆ: ì˜¤ì „ ë¯¸íŒ… ë‚´ìš© í¬í•¨ë¨"></textarea>
          </div>
        </div>

        <!-- ê°•ì˜/ì„¸ë¯¸ë‚˜ í•„ë“œ -->
        <div class="cat-fields" id="fields-lecture">
          <div class="field">
            <label for="lec-title">ê°•ì˜ ì œëª©</label>
            <input type="text" id="lec-title" placeholder="ê°•ì˜ëª… ë˜ëŠ” ì£¼ì œ">
          </div>
          <div class="field">
            <label for="lec-source">ê°•ì‚¬/ì¶œì²˜ <span class="opt">(ì„ íƒ)</span></label>
            <input type="text" id="lec-source" placeholder="ì˜ˆ: ê¹€ì² ìˆ˜ êµìˆ˜, Coursera">
          </div>
          <div class="field">
            <label for="lec-context">í•™ìŠµ ë§¥ë½ <span class="opt">(ì„ íƒ)</span></label>
            <textarea id="lec-context" rows="2" placeholder="ì˜ˆ: ì œì–´ ì‹œìŠ¤í…œ ìŠ¤í„°ë”” 3ì£¼ì°¨"></textarea>
          </div>
        </div>

        <!-- ë ˆí¼ëŸ°ìŠ¤ ë¦¬ë·° í•„ë“œ -->
        <div class="cat-fields" id="fields-reference">
          <div class="field">
            <label for="ref-title">ë ˆí¼ëŸ°ìŠ¤ ì œëª©</label>
            <input type="text" id="ref-title" placeholder="ë…¼ë¬¸ëª… ë˜ëŠ” ë¬¸ì„œëª…">
          </div>
          <div class="field">
            <label for="ref-source">ì¶œì²˜ <span class="opt">(ì„ íƒ)</span></label>
            <input type="text" id="ref-source" placeholder="ì˜ˆ: IEEE, ì‚¬ë‚´ ê¸°ìˆ  ë¬¸ì„œ">
          </div>
          <div class="field">
            <label for="ref-context">ê²€í†  ëª©ì  <span class="opt">(ì„ íƒ)</span></label>
            <textarea id="ref-context" rows="2" placeholder="ì˜ˆ: USV í•­ë²• ì•Œê³ ë¦¬ì¦˜ ê°œì„  ì°¸ê³ ìš©"></textarea>
          </div>
        </div>

        <button id="btn" disabled>ë¶„ì„ ì‹œì‘</button>
        <button id="cancel-btn">â–  ì²˜ë¦¬ ì¤‘ë‹¨</button>
        <div id="err"></div>
      </div>

      <!-- ì§„í–‰ ì„¹ì…˜ -->
      <div id="progress" class="card-body">
        <div class="steps">
          <div class="step" id="s-upload">
            <div class="ico"></div><span class="step-label">ì—…ë¡œë“œ</span>
          </div>
          <div class="step" id="s-trans">
            <div class="ico"></div><span class="step-label">Whisper ì „ì‚¬</span>
          </div>
          <div class="step" id="s-ai">
            <div class="ico"></div><span class="step-label">AI ë¶„ì„</span>
          </div>
          <div class="step" id="s-save">
            <div class="ico"></div><span class="step-label">Vault ì €ì¥</span>
          </div>
        </div>
        <div id="progress-bar-wrap"><div id="progress-bar"></div></div>
        <div id="progress-detail">
          <span class="detail-text" id="detail-text"></span>
          <span class="elapsed-text" id="elapsed-text"></span>
        </div>
        <div id="log-panel"></div>
      </div>
    </div>
  </div>

  <!-- ì˜¤ë¥¸ìª½: ê²€í† /ê²°ê³¼ -->
  <div class="col-right">
    <div id="right-placeholder">
      <div class="ph-icon">
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.25">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
        </svg>
      </div>
      ë¶„ì„ ì™„ë£Œ í›„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤
    </div>

    <div id="review-panel">
      <div class="review-header">
        <div class="review-badge"></div>
        <span class="review-title">ë¶„ì„ ê²°ê³¼ ê²€í†  â€” ì €ì¥ ì „ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”</span>
      </div>
      <div class="review-body">
        <!-- ê³µí†µ: í™”ì ì´ë¦„ -->
        <div class="rv-field">
          <label>í™”ì ì´ë¦„ ì§€ì • <span class="opt">(ì„ íƒ)</span></label>
          <div id="rv-speakers"></div>
        </div>
        <!-- ì¹´í…Œê³ ë¦¬ë³„ ë¶„ì„ í•„ë“œ (JSë¡œ ë Œë”ë§) -->
        <div id="rv-analysis-fields"></div>
        <div class="rv-actions">
          <button id="rv-save-btn">Vaultì— ì €ì¥</button>
          <button id="rv-cancel-btn">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>

    <div id="result">
      <div class="result-card">
        <div class="result-header">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          ì²˜ë¦¬ ì™„ë£Œ
        </div>
        <div class="result-body">
          <p class="result-hint">Obsidianì—ì„œ ë°”ë¡œ ì—´ê¸°</p>
          <a id="lnk-note" class="obs-btn" href="#">
            <span class="obs-btn-icon">ğŸ“</span><span id="lnk-note-label">ë…¸íŠ¸ ì—´ê¸°</span>
          </a>
          <a id="lnk-transcript" class="obs-btn" href="#" style="display:none">
            <span class="obs-btn-icon">ğŸ“„</span>ì „ì‚¬ ë…¸íŠ¸ ì—´ê¸°
          </a>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  // â”€â”€ ì¹´í…Œê³ ë¦¬ íƒ­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let currentCategory = 'meeting';

  const CAT_FIELDS = {
    meeting:    'fields-meeting-like',
    voice_memo: 'fields-voice-memo',
    daily:      'fields-daily',
    lecture:    'fields-lecture',
    discussion: 'fields-meeting-like',  // ê³µìœ 
    reference:  'fields-reference',
  };

  const CAT_LABELS = {
    meeting:    'íšŒì˜',
    voice_memo: 'ë³´ì´ìŠ¤ ë©”ëª¨',
    daily:      'ë°ì¼ë¦¬',
    lecture:    'ê°•ì˜/ì„¸ë¯¸ë‚˜',
    discussion: 'í”„ë¡œì íŠ¸ ë…¼ì˜',
    reference:  'ë ˆí¼ëŸ°ìŠ¤',
  };

  document.querySelectorAll('.cat-tab').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.cat-tab').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentCategory = btn.dataset.cat;
      switchCategoryFields(currentCategory);
    });
  });

  function switchCategoryFields(cat) {
    const shown = new Set();
    document.querySelectorAll('.cat-fields').forEach(el => el.classList.remove('visible'));
    const fieldId = CAT_FIELDS[cat] || 'fields-meeting-like';
    if (!shown.has(fieldId)) {
      document.getElementById(fieldId).classList.add('visible');
      shown.add(fieldId);
    }
    const projectField = document.getElementById('project-field');
    if (projectField) {
      projectField.style.display = (cat === 'meeting' || cat === 'discussion') ? 'block' : 'none';
    }
    const titleLabel = document.getElementById('title-label');
    if (titleLabel) titleLabel.textContent = CAT_LABELS[cat] + ' ì œëª©';
    const contextLabel = document.getElementById('context-label');
    if (contextLabel) contextLabel.innerHTML = CAT_LABELS[cat] + ' ë§¥ë½ <span class="opt">(ì „ì‚¬Â·ë¶„ì„ ì •í™•ë„ í–¥ìƒ)</span>';
  }

  function getFormValues() {
    const cat = currentCategory;
    let titleVal = '', contextVal = '';
    if (cat === 'meeting' || cat === 'discussion') {
      titleVal   = document.getElementById('title').value;
      contextVal = document.getElementById('context').value;
    } else if (cat === 'voice_memo') {
      titleVal   = document.getElementById('vm-title').value;
      contextVal = document.getElementById('vm-context').value;
    } else if (cat === 'daily') {
      titleVal   = '';
      contextVal = document.getElementById('daily-context').value;
    } else if (cat === 'lecture') {
      titleVal   = document.getElementById('lec-title').value;
      contextVal = document.getElementById('lec-context').value;
    } else if (cat === 'reference') {
      titleVal   = document.getElementById('ref-title').value;
      contextVal = document.getElementById('ref-context').value;
    }
    return { titleVal, contextVal };
  }

  // â”€â”€ íŒŒì¼ ì„ íƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const dz = document.getElementById('drop-zone');
  const fi = document.getElementById('fi');
  const btn = document.getElementById('btn');
  const fname = document.getElementById('fname');
  let file = null;

  dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('over'); });
  dz.addEventListener('dragleave', () => dz.classList.remove('over'));
  dz.addEventListener('drop', e => {
    e.preventDefault(); dz.classList.remove('over');
    if (e.dataTransfer.files[0]) setFile(e.dataTransfer.files[0]);
  });
  fi.addEventListener('change', () => { if (fi.files[0]) setFile(fi.files[0]); });
  function setFile(f) { file = f; fname.textContent = f.name; btn.disabled = false; }

  // â”€â”€ ë§ˆì´í¬ ë…¹ìŒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let recChunks = [], mediaRecorder = null, recStream = null;
  let recTimerInterval = null, recSecs = 0;
  const recStartBtn      = document.getElementById('rec-start-btn');
  const recStopBtn       = document.getElementById('rec-stop-btn');
  const recConfirmOk     = document.getElementById('rec-confirm-ok');
  const recConfirmCancel = document.getElementById('rec-confirm-cancel');
  let pendingRecFile = null;

  if (!window.MediaRecorder) {
    recStartBtn.disabled = true;
    recStartBtn.textContent = 'ë…¹ìŒ (ì´ ë¸Œë¼ìš°ì € ë¯¸ì§€ì›)';
  }

  recStartBtn.addEventListener('click', startRecording);
  recStopBtn.addEventListener('click', stopRecording);
  recConfirmOk.addEventListener('click', () => {
    if (!pendingRecFile) return;
    setFile(pendingRecFile); pendingRecFile = null; _showRecIdle();
    document.getElementById('btn').click();
  });
  recConfirmCancel.addEventListener('click', () => { pendingRecFile = null; _showRecIdle(); });

  async function startRecording() {
    try { recStream = await navigator.mediaDevices.getUserMedia({ audio: true }); }
    catch (e) { showErr('ë§ˆì´í¬ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤: ' + e.message); return; }
    recChunks = [];
    const mimeType = MediaRecorder.isTypeSupported('audio/webm') ? 'audio/webm' : 'audio/ogg';
    mediaRecorder = new MediaRecorder(recStream, { mimeType });
    mediaRecorder.ondataavailable = e => { if (e.data.size > 0) recChunks.push(e.data); };
    mediaRecorder.onstop = () => {
      const blob = new Blob(recChunks, { type: mimeType });
      const ts = new Date().toISOString().replace(/[-:.TZ]/g, '').slice(0, 15);
      const ext = mimeType.includes('webm') ? 'webm' : 'ogg';
      pendingRecFile = new File([blob], `recording_${ts}.${ext}`, { type: mimeType });
      _stopRecTimer();
      const m = String(Math.floor(recSecs / 60)).padStart(2,'0');
      const s = String(recSecs % 60).padStart(2,'0');
      document.getElementById('rec-confirm-label').textContent = `${m}:${s} ë…¹ìŒë¨`;
      _showRecConfirm();
    };
    mediaRecorder.start();
    recSecs = 0;
    recTimerInterval = setInterval(() => {
      recSecs++;
      const m = String(Math.floor(recSecs / 60)).padStart(2,'0');
      const s = String(recSecs % 60).padStart(2,'0');
      document.getElementById('rec-timer').textContent = `${m}:${s}`;
    }, 1000);
    _showRecActive();
  }

  function stopRecording() {
    if (mediaRecorder && mediaRecorder.state !== 'inactive') mediaRecorder.stop();
    if (recStream) { recStream.getTracks().forEach(t => t.stop()); recStream = null; }
  }
  function _stopRecTimer() { clearInterval(recTimerInterval); recTimerInterval = null; }
  function _showRecActive()  { document.getElementById('rec-idle').style.display='none'; document.getElementById('rec-active').style.display='flex'; document.getElementById('rec-confirm').style.display='none'; }
  function _showRecConfirm() { document.getElementById('rec-idle').style.display='none'; document.getElementById('rec-active').style.display='none'; document.getElementById('rec-confirm').style.display='flex'; }
  function _showRecIdle()    { document.getElementById('rec-idle').style.display='block'; document.getElementById('rec-active').style.display='none'; document.getElementById('rec-confirm').style.display='none'; }

  // â”€â”€ ë¼ì´ë¸Œ ë¡œê·¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let lastLogIndex = 0, cursorEl = null;

  function appendLogs(logs) {
    if (!logs || logs.length <= lastLogIndex) return;
    const panel = document.getElementById('log-panel');
    panel.style.display = 'block';
    const prev = panel.querySelector('.log-line.latest');
    if (prev) { prev.classList.remove('latest'); const c = prev.querySelector('.cursor'); if (c) c.remove(); }
    for (let i = lastLogIndex; i < logs.length; i++) {
      const line = document.createElement('div');
      line.className = 'log-line' + (i === logs.length - 1 ? ' latest' : '');
      line.textContent = logs[i];
      panel.appendChild(line);
    }
    lastLogIndex = logs.length;
    const lastLine = panel.querySelector('.log-line.latest');
    if (lastLine) { cursorEl = document.createElement('span'); cursorEl.className = 'cursor'; lastLine.appendChild(cursorEl); }
    panel.scrollTop = panel.scrollHeight;
  }

  function removeCursor() {
    if (cursorEl) { cursorEl.remove(); cursorEl = null; }
    const latest = document.querySelector('#log-panel .log-line.latest');
    if (latest) latest.classList.remove('latest');
  }

  // â”€â”€ ì—…ë¡œë“œ & í´ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const cancelBtn = document.getElementById('cancel-btn');
  let currentJobId = null, jobStartTime = null, elapsedTimer = null;

  function startElapsedTimer() {
    jobStartTime = Date.now(); clearInterval(elapsedTimer);
    elapsedTimer = setInterval(() => {
      const secs = Math.floor((Date.now() - jobStartTime) / 1000);
      document.getElementById('elapsed-text').textContent = `ê²½ê³¼ ${secs}ì´ˆ`;
    }, 1000);
  }
  function stopElapsedTimer() { clearInterval(elapsedTimer); elapsedTimer = null; }

  cancelBtn.addEventListener('click', async () => {
    if (!currentJobId) return;
    cancelBtn.disabled = true; cancelBtn.textContent = 'ì·¨ì†Œ ì¤‘...';
    try { await fetch(`/cancel/${currentJobId}`, { method: 'POST' }); } catch (e) {}
  });

  btn.addEventListener('click', async () => {
    if (!file) return;
    btn.disabled = true; currentJobId = null; lastLogIndex = 0;
    const logPanel = document.getElementById('log-panel');
    logPanel.innerHTML = ''; logPanel.style.display = 'none';
    progress.style.display = 'block';
    cancelBtn.style.display = 'block'; cancelBtn.disabled = false; cancelBtn.textContent = 'â–  ì²˜ë¦¬ ì¤‘ë‹¨';
    document.getElementById('right-placeholder').style.display = 'flex';
    hide('result'); hide('err'); hide('review-panel');
    ['s-upload','s-trans','s-ai','s-save'].forEach(id => setStep(id, ''));
    document.getElementById('detail-text').textContent = '';
    document.getElementById('elapsed-text').textContent = '';
    document.getElementById('progress-bar').style.width = '0%';
    setStep('s-upload', 'active');

    const { titleVal, contextVal } = getFormValues();
    const fd = new FormData();
    fd.append('file', file);
    fd.append('title', titleVal);
    fd.append('project', document.getElementById('project').value || '');
    fd.append('context', contextVal);
    fd.append('category', currentCategory);

    let jobId;
    try {
      const r = await fetch('/upload', { method: 'POST', body: fd });
      const d = await r.json();
      if (!r.ok) throw new Error(d.detail || 'ì—…ë¡œë“œ ì‹¤íŒ¨');
      jobId = d.job_id;
    } catch (e) { return showErr(e.message); }

    currentJobId = jobId;
    startElapsedTimer();
    setStep('s-upload', 'done');
    poll(jobId);
  });

  function poll(id) {
    const t = setInterval(async () => {
      try {
        const d = await fetch(`/status/${id}`).then(r => r.json());
        if (d.status === 'review') {
          setStep('s-ai', 'done');
          setProgress(97, 'ë¶„ì„ ì™„ë£Œ â€” ë‚´ìš©ì„ í™•ì¸í•˜ê³  ì €ì¥í•˜ì„¸ìš”.');
          appendLogs(d.logs);
          showReviewPanel(d.analysis, d.speakers, d.category || 'meeting');
          return;
        } else if (d.status === 'confirmed' || d.status === 'building' || d.status === 'saving') {
          hide('review-panel'); cancelBtn.style.display = 'block';
          if (d.status === 'building' || d.status === 'saving') { setStep('s-ai','done'); setStep('s-save','active'); }
        } else if (d.status === 'cancelling') {
          cancelBtn.textContent = 'â³ í˜„ì¬ ë‹¨ê³„ ì™„ë£Œ í›„ ì¤‘ë‹¨ë©ë‹ˆë‹¤...';
        } else if (d.status === 'transcribing') {
          setStep('s-trans', 'active');
        } else if (d.status === 'analyzing') {
          setStep('s-trans', 'done'); setStep('s-ai', 'active');
        } else if (d.status === 'done') {
          clearInterval(t); setStep('s-save', 'done');
          setProgress(100, d.detail || 'ì™„ë£Œ'); stopElapsedTimer();
          appendLogs(d.logs); removeCursor(); cancelBtn.style.display = 'none';
          document.getElementById('right-placeholder').style.display = 'none';
          const noteLink = document.getElementById('lnk-note');
          const noteLabel = document.getElementById('lnk-note-label');
          noteLink.href = d.result.note_uri || d.result.meeting_uri || '#';
          noteLabel.textContent = d.category === 'meeting' ? 'íšŒì˜ ë…¸íŠ¸ ì—´ê¸°'
            : d.category === 'discussion' ? 'ë…¼ì˜ ë…¸íŠ¸ ì—´ê¸°'
            : d.category === 'daily' ? 'ì—…ë¬´ì¼ì§€ ì—´ê¸°'
            : d.category === 'lecture' ? 'ê°•ì˜ ë…¸íŠ¸ ì—´ê¸°'
            : d.category === 'reference' ? 'ë ˆí¼ëŸ°ìŠ¤ ë…¸íŠ¸ ì—´ê¸°'
            : 'ë…¸íŠ¸ ì—´ê¸°';
          const transcriptLink = document.getElementById('lnk-transcript');
          if (d.result.transcript_uri) {
            transcriptLink.href = d.result.transcript_uri;
            transcriptLink.style.display = 'flex';
          } else {
            transcriptLink.style.display = 'none';
          }
          show('result'); btn.disabled = false; return;
        } else if (d.status === 'cancelled') {
          clearInterval(t); appendLogs(d.logs); removeCursor(); stopElapsedTimer();
          cancelBtn.style.display = 'none'; showErr('ì²˜ë¦¬ê°€ ì·¨ì†ŒëìŠµë‹ˆë‹¤.'); btn.disabled = false; return;
        } else if (d.status === 'error') {
          clearInterval(t); appendLogs(d.logs); removeCursor(); stopElapsedTimer();
          cancelBtn.style.display = 'none'; showErr(d.error); btn.disabled = false; return;
        }
        setProgress(d.progress || 0, d.detail || '');
        appendLogs(d.logs);
      } catch (e) { clearInterval(t); showErr(e.message); btn.disabled = false; }
    }, 1500);
  }

  function setProgress(pct, detail) {
    document.getElementById('progress-bar').style.width = pct + '%';
    document.getElementById('detail-text').textContent = detail;
  }

  const ICONS = { '': '', active: 'â–¶', done: 'âœ“' };
  function setStep(id, state) {
    const el = document.getElementById(id);
    el.className = `step ${state}`;
    el.querySelector('.ico').textContent = ICONS[state] ?? '';
  }

  const progress = document.getElementById('progress');
  function show(id) { document.getElementById(id).style.display = 'block'; }
  function hide(id) { document.getElementById(id).style.display = 'none'; }
  function showErr(msg) {
    const el = document.getElementById('err');
    el.textContent = 'ì˜¤ë¥˜: ' + msg; el.style.display = 'block'; btn.disabled = false;
  }

  // â”€â”€ í”„ë¡œì íŠ¸ ëª©ë¡ ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadProjects() {
    try {
      const projects = await fetch('/projects').then(r => r.json());
      const sel = document.getElementById('project');
      projects.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.link; opt.textContent = p.display;
        sel.appendChild(opt);
      });
    } catch (e) { console.warn('í”„ë¡œì íŠ¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', e); }
  }
  loadProjects();

  // â”€â”€ ê²€í†  íŒ¨ë„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const CATEGORY_REVIEW_FIELDS = {
    meeting: [
      { id: 'purpose',      label: 'íšŒì˜ ëª©ì ',   rows: 2, isList: false },
      { id: 'discussion',   label: 'ì£¼ìš” ë…¼ì˜',   rows: 3, isList: true },
      { id: 'decisions',    label: 'ê²°ì • ì‚¬í•­',   rows: 2, isList: true },
      { id: 'action_items', label: 'ì•¡ì…˜ ì•„ì´í…œ', rows: 3, isList: true },
      { id: 'follow_up',    label: 'í›„ì† ê³¼ì œ',   rows: 2, isList: true },
    ],
    discussion: [
      { id: 'purpose',      label: 'ëª©ì ',       rows: 2, isList: false },
      { id: 'discussion',   label: 'ì£¼ìš” ë…¼ì˜',  rows: 3, isList: true },
      { id: 'decisions',    label: 'ê²°ì • ì‚¬í•­',  rows: 2, isList: true },
      { id: 'action_items', label: 'ì•¡ì…˜ ì•„ì´í…œ',rows: 3, isList: true },
      { id: 'follow_up',    label: 'í›„ì† ì§ˆë¬¸',  rows: 2, isList: true },
    ],
    voice_memo: [
      { id: 'summary',      label: 'ìš”ì•½',       rows: 2, isList: false },
      { id: 'key_points',   label: 'í•µì‹¬ í¬ì¸íŠ¸',rows: 3, isList: true },
      { id: 'action_items', label: 'í•  ì¼',      rows: 2, isList: true },
    ],
    daily: [
      { id: 'tasks_done',     label: 'ì™„ë£Œ ì—…ë¬´',  rows: 3, isList: true },
      { id: 'tasks_tomorrow', label: 'ë‚´ì¼ í•  ì¼', rows: 3, isList: true },
      { id: 'issues',         label: 'ë¬¸ì œ/ì´ìŠˆ',  rows: 2, isList: true },
      { id: 'reflection',     label: 'ì†Œê°',       rows: 2, isList: false },
    ],
    lecture: [
      { id: 'summary',          label: 'ê°•ì˜ ìš”ì•½',  rows: 2, isList: false },
      { id: 'key_concepts',     label: 'í•µì‹¬ ê°œë…',  rows: 3, isList: true },
      { id: 'important_points', label: 'ì¤‘ìš” í¬ì¸íŠ¸',rows: 3, isList: true },
      { id: 'references',       label: 'ì°¸ê³  ìë£Œ',  rows: 2, isList: true },
      { id: 'questions',        label: 'ì§ˆë¬¸',       rows: 2, isList: true },
    ],
    reference: [
      { id: 'summary',       label: 'ìš”ì•½',              rows: 2, isList: false },
      { id: 'key_findings',  label: 'í•µì‹¬ ë°œê²¬',         rows: 3, isList: true },
      { id: 'methodology',   label: 'ë°©ë²•ë¡ ',            rows: 2, isList: false },
      { id: 'applicability', label: 'ì—…ë¬´ ì ìš© ê°€ëŠ¥ì„±',  rows: 2, isList: false },
      { id: 'citations',     label: 'ì¸ìš©',              rows: 2, isList: true },
    ],
  };

  function showReviewPanel(analysis, speakers, category) {
    if (!analysis) return;
    document.getElementById('right-placeholder').style.display = 'none';

    const speakerSection = document.getElementById('rv-speakers');
    speakerSection.innerHTML = '';
    (speakers || []).forEach(sp => {
      const row = document.createElement('div');
      row.className = 'rv-speaker-row';
      row.innerHTML = `<span class="rv-speaker-label">${sp}</span><span class="rv-speaker-arrow">â†’</span><input type="text" class="rv-speaker-input" data-speaker="${sp}" placeholder="ì‹¤ëª… (ë¹„ì›Œë‘ë©´ ${sp})">`;
      speakerSection.appendChild(row);
    });

    const fields = CATEGORY_REVIEW_FIELDS[category] || CATEGORY_REVIEW_FIELDS['meeting'];
    const container = document.getElementById('rv-analysis-fields');
    container.innerHTML = '';
    fields.forEach(f => {
      const div = document.createElement('div');
      div.className = 'rv-field';
      const val = analysis[f.id];
      const displayVal = f.isList ? (val || []).join('\n') : (val || '');
      div.innerHTML = `<label>${f.label}${f.isList ? ' <span class="opt">(ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)</span>' : ''}</label><textarea id="rv-${f.id}" rows="${f.rows}">${displayVal}</textarea>`;
      container.appendChild(div);
    });

    document.getElementById('review-panel').style.display = 'block';
    cancelBtn.style.display = 'none';
    const rvSave = document.getElementById('rv-save-btn');
    rvSave.disabled = false; rvSave.textContent = 'Vaultì— ì €ì¥';
  }

  document.getElementById('rv-save-btn').addEventListener('click', async () => {
    const saveBtn = document.getElementById('rv-save-btn');
    saveBtn.disabled = true; saveBtn.textContent = 'ì €ì¥ ì¤‘...';

    const speakerMap = {};
    document.querySelectorAll('.rv-speaker-input').forEach(input => {
      const val = input.value.trim(); if (val) speakerMap[input.dataset.speaker] = val;
    });

    const analysis = {};
    const cat = currentCategory;
    const fields = CATEGORY_REVIEW_FIELDS[cat] || CATEGORY_REVIEW_FIELDS['meeting'];
    fields.forEach(f => {
      const el = document.getElementById(`rv-${f.id}`);
      if (!el) return;
      analysis[f.id] = f.isList
        ? el.value.split('\n').map(l => l.trim()).filter(Boolean)
        : el.value.trim();
    });

    const payload = { speaker_map: speakerMap, analysis };
    try {
      const r = await fetch(`/confirm/${currentJobId}`, {
        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload),
      });
      if (!r.ok) throw new Error(await r.text());
      hide('review-panel'); setStep('s-save', 'active');
    } catch (e) {
      saveBtn.disabled = false; saveBtn.textContent = 'Vaultì— ì €ì¥';
      showErr('ì €ì¥ ìš”ì²­ ì‹¤íŒ¨: ' + e.message);
    }
  });

  document.getElementById('rv-cancel-btn').addEventListener('click', async () => {
    if (!currentJobId) return;
    hide('review-panel');
    document.getElementById('right-placeholder').style.display = 'flex';
    try { await fetch(`/cancel/${currentJobId}`, { method: 'POST' }); } catch (e) {}
    showErr('ì²˜ë¦¬ê°€ ì·¨ì†ŒëìŠµë‹ˆë‹¤.'); btn.disabled = false;
  });

  // â”€â”€ ì„¤ì • ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const overlay = document.getElementById('modal-overlay');
  document.getElementById('settings-btn').addEventListener('click', openSettings);
  document.getElementById('modal-close').addEventListener('click', () => overlay.classList.remove('open'));
  overlay.addEventListener('click', e => { if (e.target === overlay) overlay.classList.remove('open'); });

  async function openSettings() {
    try {
      const s = await fetch('/settings').then(r => r.json());
      document.getElementById('s-whisper').value = s.WHISPER_MODEL || 'base';
      document.getElementById('s-vault').value   = s.VAULT_PATH || '';
      document.getElementById('s-folder').value  = s.MEETINGS_FOLDER || '';
      document.getElementById('s-domain-vocab').value = s.DOMAIN_VOCAB || '';
      document.getElementById('s-inbox-folder').value    = s.INBOX_FOLDER    || '';
      document.getElementById('s-daily-folder').value    = s.DAILY_FOLDER    || '';
      document.getElementById('s-areas-folder').value    = s.AREAS_FOLDER    || '';
      document.getElementById('s-projects-folder').value = s.PROJECTS_FOLDER || '';
      document.getElementById('s-resources-folder').value = s.RESOURCES_FOLDER || '';
      document.getElementById('s-gemini').placeholder = s.GEMINI_API_KEY ? 'â—â—â—â—â—â—â—â— (ë³€ê²½ ì‹œ ì…ë ¥)' : 'AIza...';
      document.getElementById('s-openai').placeholder = s.OPENAI_API_KEY ? 'â—â—â—â—â—â—â—â— (ë³€ê²½ ì‹œ ì…ë ¥)' : 'sk-...';
      document.getElementById('s-hf').placeholder     = s.HF_TOKEN      ? 'â—â—â—â—â—â—â—â— (ë³€ê²½ ì‹œ ì…ë ¥)' : 'hf_...';
      document.getElementById('save-msg').textContent = '';
    } catch (e) { document.getElementById('save-msg').textContent = 'ì„¤ì • ë¡œë“œ ì‹¤íŒ¨: ' + e.message; }
    overlay.classList.add('open');
  }

  document.getElementById('save-btn').addEventListener('click', async () => {
    const payload = {
      WHISPER_MODEL: document.getElementById('s-whisper').value,
      GEMINI_API_KEY: document.getElementById('s-gemini').value,
      OPENAI_API_KEY: document.getElementById('s-openai').value,
      HF_TOKEN:       document.getElementById('s-hf').value,
      VAULT_PATH:     document.getElementById('s-vault').value,
      MEETINGS_FOLDER: document.getElementById('s-folder').value,
      INBOX_FOLDER:     document.getElementById('s-inbox-folder').value,
      DAILY_FOLDER:     document.getElementById('s-daily-folder').value,
      AREAS_FOLDER:     document.getElementById('s-areas-folder').value,
      PROJECTS_FOLDER:  document.getElementById('s-projects-folder').value,
      RESOURCES_FOLDER: document.getElementById('s-resources-folder').value,
      DOMAIN_VOCAB:   document.getElementById('s-domain-vocab').value,
    };
    try {
      const r = await fetch('/settings', {
        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload),
      });
      if (!r.ok) throw new Error(await r.text());
      document.getElementById('save-msg').textContent = 'ì €ì¥ëìŠµë‹ˆë‹¤.';
      ['s-gemini','s-openai','s-hf'].forEach(id => document.getElementById(id).value = '');
      setTimeout(() => overlay.classList.remove('open'), 800);
    } catch (e) { document.getElementById('save-msg').textContent = 'ì €ì¥ ì‹¤íŒ¨: ' + e.message; }
  });
</script>
</body>
</html>
